(window.webpackJsonp=window.webpackJsonp||[]).push([[61],{Ajdk:function(t,e,n){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var o=h(n("6ZY3")),r=h(n("cLjf")),a=h(n("hDQ3")),i=h(n("YReu")),s=h(n("bS4n")),u=n("dzbt"),c=h(n("7Qib")),l=h(n("tI4l")),f=n("mS6s"),d=h(n("kJQY")),p=h(n("3vVk"));function h(t){return t&&t.__esModule?t:{default:t}}function m(){window.scrollTo(0,1e5),this.showBtn=!0}e.default={components:{UploadTip:p.default,VueEditor:f.VueEditor,CustomVideo:d.default},data:function(){return{showUploadPop:!1,uploadOptions:{type:"photo",interface_type:"img",form_source:3},processing:!1,customToolbar:[{align:""},{align:"center"},{align:"right"},"bold","italic","image"],showCascader:!1,cascaderList:[],title:"",message:"",showAuditor:!1,showToolbar:!1,contents:[],editorOption:{debug:"info",modules:{toolbar:"#toolbar"},placeholder:"",theme:"snow"},form:{type:"1",id:"",whEnrollId:"",title:"",content:""},info:{reason:""},showReason:!1,currentSelect:0,showBtn:!0,rangIndex:0,sourceType:"",rejectReason:"",auditInfo:null}},computed:(0,s.default)({},(0,u.mapState)(["userInfo","pageOffsetHeight"]),{navTitle:function(){return this.$route.query.id||""?"修改大纲":"上传大纲"}}),mounted:function(){var t=this;if(window.documentDetails){var e=(0,i.default)(window.documentDetails,[]);this.form=e,this.form.type=1}else this.$route.query.id?this.getDocumentDetails():this.form=window.documentDetails||{type:"1",actId:this.$route.query.actId,author:this.userInfo.name||this.userInfo.userName,content:"",title:""};this.$refs.editor.$refs.fileInput.type="button",this.$refs.editor.$refs.fileInput.onclick=function(){t.imageAdd(),t.$nextTick((function(){t.$refs.input.focus(),setTimeout((function(){t.$refs.input.blur()}),0)}))},document.body.addEventListener("focusout",m.bind(this)),this.$refs.editor.$el.style.height=(this.pageOffsetHeight||document.body.offsetHeight)/2-50+"px"},beforeDestory:function(){document.body.removeEventListener("focusout",m.bind(this))},methods:{defaultPopConfirm:function(t){this.form.sourceType=t.label,this.sourceType=t.value},focus:function(t){if(this.isIOS){for(var e=this.$refs.editor.$refs.quillContainer.querySelector(".ql-editor").children,n=e[e.length-1],o=n.offsetHeight;"app"!==n.id;)o+=n.offsetTop||0,n=n.parentNode;window.scrollTo(0,o),this.showBtn=!1}},blur:function(){this.isIOS&&(window.scrollTo(0,1e5),this.showBtn=!0)},change:function(t,e){this.rangIndex=(e||{}).index||0},beforeClose:function(t,e){"confirm"===t?this.onSubmit("false",e):e()},onClickLeft:function(){window.documentDetails=null,this.$router.go(-1)},onSubmit:function(t,e){this.$route.query.id?this.updateDocument(t,e):this.addDocument()},toPreview:function(){window.documentDetails=this.form,this.$router.push({name:"CreatePreview"})},addDocument:function(){var t=this;return(0,a.default)(r.default.mark((function e(){var n,o,a,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.processing){e.next=3;break}return t.$toast.fail("请勿重复提交"),e.abrupt("return");case 3:if(t.processing=!0,n=t.form,o=n.title,a=n.content,t.form.actId){e.next=8;break}return t.processing=!1,e.abrupt("return",t.$toast.fail("活动id不能为空"));case 8:if(!c.default.isEmpty(o,"请输入标题")){e.next=11;break}return t.processing=!1,e.abrupt("return");case 11:if(!c.default.isEmpty(a,"请添加内容")){e.next=14;break}return t.processing=!1,e.abrupt("return");case 14:return e.next=16,t.$api.base.checkSensitiveWord({isLoad:!1,type:1,content:""+a+o});case 16:if(0!==(i=e.sent).code){e.next=20;break}return t.processing=!1,e.abrupt("return",t.$toast.fail(i.message));case 20:return t.form.whEnrollId=t.$route.query.whEnrollId,e.next=23,t.$api.document.insert(t.form);case 23:e.sent,t.processing=!1,t.onClickLeft();case 26:case"end":return e.stop()}}),e,t)})))()},updateDocument:function(t,e){var n=this;return(0,a.default)(r.default.mark((function a(){var s,u,l,f;return r.default.wrap((function(r){for(;;)switch(r.prev=r.next){case 0:if(s=n.form,u=s.title,l=s.content,!c.default.isEmpty(u,"请输入标题")){r.next=3;break}return r.abrupt("return");case 3:if(1!==n.form.type||!c.default.isEmpty(l,"请添加文章内容")){r.next=5;break}return r.abrupt("return");case 5:if("false"!==t||!c.default.isEmpty(n.info.reason,"请输入作废原因")){r.next=8;break}return e(!1),r.abrupt("return",!1);case 8:return f=(0,i.default)(n.info,[]),n.info=(0,o.default)({passStr:t},f,n.auditInfo),r.next=12,n.$api.document.update({info:n.info,personalNews:n.form});case 12:r.sent,"function"==typeof e&&(n.form.reason="",e()),n.onClickLeft();case 15:case"end":return r.stop()}}),a,n)})))()},getDocumentDetails:function(){var t=this;return(0,a.default)(r.default.mark((function e(){var n,o,a,i;return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.document.detail({id:t.$route.query.id});case 2:return n=e.sent,e.next=5,t.$api.todo.myPersonalNewsAuditLog({id:t.$route.query.id});case 5:return(o=e.sent).data&&o.data.length>0&&2==(a=o.data.pop()).pass&&(t.rejectReason=a.remark),e.next=9,t.$api.task.queryTaskByPersonalNewsId({id:t.$route.query.id});case 9:(i=e.sent).data&&(t.auditInfo=i.data),t.form=n.data,l.default.sourceType.forEach((function(e){e.value===t.form.sourceType&&(t.sourceType=e.label)}));case 13:case"end":return e.stop()}}),e,t)})))()},uploadCallback:function(t){t.filePath&&t.filePath.match(/^\/files\//)?this.$refs.editor.quill.insertEmbed(this.rangIndex,"image",t.filePath):this.$toast("上传失败")},imageAdd:function(){var t=this;return(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.showUploadPop=!0,t.showBtn=!0;case 2:case"end":return e.stop()}}),e,t)})))()},imageDel:function(t){},saveDocument:function(){this.form.isDraft="1",this.onSubmit()}},beforeRouteEnter:function(t,e,n){"CreatePreview"!==e.name&&delete window.documentDetails,n()}}},EHSe:function(t,e,n){"use strict";n.r(e);var o=n("UJxv"),r=n("rT/o");for(var a in r)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return r[t]}))}(a);n("yz7D");var i=n("gp09"),s=Object(i.a)(r.default,o.a,o.b,!1,null,null,null);e.default=s.exports},J1ny:function(t,e,n){},UJxv:function(t,e,n){"use strict";n.d(e,"a",(function(){return o})),n.d(e,"b",(function(){return r}));var o=function(){var t=this,e=t._self._c;return e("div",{staticClass:"create_add_wrap"},[e("van-nav-bar",{directives:[{name:"show",rawName:"v-show",value:t.showBtn,expression:"showBtn"}],attrs:{title:t.navTitle,"left-arrow":"","right-text":"预览",fixed:""},on:{"click-left":t.onClickLeft,"click-right":t.toPreview}}),t._v(" "),e("div",{staticClass:"main_wrap"},[t.rejectReason?e("van-notice-bar",{attrs:{color:"#1989fa",background:"#ecf9ff","left-icon":"info-o",mode:"closeable",wrapable:"",scrollable:!1}},[t._v("驳回原因: "+t._s(t.rejectReason))]):t._e(),t._v(" "),e("van-form",[e("van-field",{attrs:{label:"标题",placeholder:"请输入标题/说明",rows:"1",autosize:"","input-align":"right",type:"textarea"},model:{value:t.form.title,callback:function(e){t.$set(t.form,"title",e)},expression:"form.title"}})],1),t._v(" "),e("van-form",[e("van-cell-group",{staticClass:"group_content",attrs:{title:"内容",border:!1}},[e("vue-editor",{ref:"editor",attrs:{editorToolbar:t.customToolbar,useCustomImageHandler:""},on:{"selection-change":t.change,focus:t.focus,blur:t.blur},model:{value:t.form.content,callback:function(e){t.$set(t.form,"content",e)},expression:"form.content"}})],1),t._v(" "),e("input",{ref:"input",staticStyle:{"pointer-events":"none"},attrs:{type:"text"}})],1),t._v(" "),e("div",{directives:[{name:"show",rawName:"v-show",value:!t.showBtn,expression:"!showBtn"}],staticClass:"keyboard_container"}),t._v(" "),e("div",{staticClass:"bottom_btns"},[t.$route.query.id?e("van-row",{attrs:{gutter:"20"}},[e("van-col",{attrs:{span:"12"}},[e("van-button",{staticClass:"g_btn_gray",attrs:{type:"default",block:""},on:{click:function(e){t.showReason=!0}}},[t._v("作废")])],1),t._v(" "),e("van-col",{attrs:{span:"12"}},[e("van-button",{attrs:{type:"info",block:""},on:{click:function(e){return t.onSubmit("true")}}},[t._v("提交")])],1)],1):e("van-row",{attrs:{gutter:"20"}},[e("van-col",{attrs:{span:"24"}},[e("van-button",{attrs:{type:"info",block:""},on:{click:function(e){return t.saveDocument()}}},[t._v("提交")])],1)],1)],1),t._v(" "),e("van-dialog",{attrs:{title:"作废原因","show-cancel-button":"","before-close":t.beforeClose},model:{value:t.showReason,callback:function(e){t.showReason=e},expression:"showReason"}},[e("van-field",{attrs:{rows:"4",type:"textarea",placeholder:"请输入作废原因",required:""},model:{value:t.info.reason,callback:function(e){t.$set(t.info,"reason",e)},expression:"info.reason"}})],1),t._v(" "),e("UploadTip",{attrs:{uploadOptions:t.uploadOptions,uploadCallback:t.uploadCallback},model:{value:t.showUploadPop,callback:function(e){t.showUploadPop=e},expression:"showUploadPop"}})],1)],1)},r=[]},"rT/o":function(t,e,n){"use strict";n.r(e);var o=n("Ajdk"),r=n.n(o);for(var a in o)["default"].indexOf(a)<0&&function(t){n.d(e,t,(function(){return o[t]}))}(a);e.default=r.a},yz7D:function(t,e,n){"use strict";n("J1ny")}}]);