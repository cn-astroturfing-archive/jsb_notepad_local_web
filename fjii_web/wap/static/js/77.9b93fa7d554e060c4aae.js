(window.webpackJsonp=window.webpackJsonp||[]).push([[77],{"9uwL":function(e,t,n){"use strict";n.r(t);var r=n("MfoN"),a=n.n(r);for(var o in r)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return r[e]}))}(o);t.default=a.a},Efgu:function(e,t,n){"use strict";n.d(t,"a",(function(){return r})),n.d(t,"b",(function(){return a}));var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"my_mod_phone_wrap"},[t("van-nav-bar",{attrs:{title:e.$route.meta.title,"left-arrow":"","right-text":"　",fixed:""},on:{"click-left":e.onClickLeft}}),e._v(" "),t("van-form",[t("van-cell-group",[t("van-field",{attrs:{label:"手机号码",placeholder:"请输入新手机号码",name:"telephone","input-align":"right",rules:[{required:!0,message:"手机号码不能为空"},{validator:e.validatePhone,message:"手机号码格式错误"}]},model:{value:e.telephone,callback:function(t){e.telephone=t},expression:"telephone"}}),e._v(" "),t("van-field",{attrs:{clearable:"",label:"短信验证码",placeholder:"短信验证码",name:"smsCode","input-align":"right"},scopedSlots:e._u([{key:"button",fn:function(){return[t("van-button",{attrs:{size:"small",type:"info",disabled:e.forbidSend},on:{click:e.sendMsgCode}},[e._v(e._s(e.forbidSend?e.sendBtnText:"获取验证码"))])]},proxy:!0}]),model:{value:e.smsCode,callback:function(t){e.smsCode=t},expression:"smsCode"}})],1),e._v(" "),t("div",{staticClass:"bottom_btns"},[t("van-button",{attrs:{type:"info",block:"","native-type":"submit",disabled:e.submiting},on:{click:e.onSubmit}},[e._v("提交")])],1)],1)],1)},a=[]},MfoN:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var r=u(n("cLjf")),a=u(n("hDQ3")),o=u(n("bS4n")),s=n("dzbt"),i=u(n("7Qib"));function u(e){return e&&e.__esModule?e:{default:e}}t.default={data:function(){return{telephone:"",smsCode:"",forbidSend:!1,sendBtnText:"",timer:null,submiting:!1}},computed:(0,o.default)({},(0,s.mapState)(["userInfo"])),watch:{smsCode:function(e){e.length>6&&(this.smsCode=e.slice(0,6))}},beforeDestroy:function(){this.timer&&clearInterval(this.timer)},methods:(0,o.default)({},(0,s.mapMutations)(["SET_USERINFO"]),{onClickLeft:function(){this.$router.go(-1)},validatePhone:function(e){return/^1\d{10}$/.test(e)},onSubmit:function(e){var t=this;return(0,a.default)(r.default.mark((function e(){return r.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t.telephone){e.next=3;break}return t.$toast.fail("请输入新手机号码"),e.abrupt("return");case 3:if(t.validatePhone(t.telephone)){e.next=6;break}return t.$toast.fail("手机号码格式错误"),e.abrupt("return");case 6:if(t.smsCode){e.next=9;break}return t.$toast.fail("请输入验证码"),e.abrupt("return");case 9:if(/^\d{6}$/.test(t.smsCode)){e.next=12;break}return t.$toast.fail("请输入6位数字验证码"),e.abrupt("return");case 12:return e.prev=12,t.submiting=!0,e.next=16,t.$api.user.doModifyPhone({isLoad:!0,newPhone:t.telephone,smsCode:t.smsCode,token:t.$route.query.token});case 16:e.sent,t.$toast.success("修改成功"),t.userInfo.telephone=t.telephone.replace(/(\d{3})\d{4}(\d{4})/g,"$1****$2"),t.SET_USERINFO(t.userInfo),setTimeout((function(){t.submiting=!1,t.$router.go(-1)}),2e3),e.next=26;break;case 23:e.prev=23,e.t0=e.catch(12),t.submiting=!1;case 26:case"end":return e.stop()}}),e,t,[[12,23]])})))()},sendMsgCode:function(){var e=this;return(0,a.default)(r.default.mark((function t(){var n;return r.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:if(!e.forbidSend){t.next=2;break}return t.abrupt("return");case 2:if(e.telephone){t.next=5;break}return e.$toast.fail("请输入新手机号码"),t.abrupt("return");case 5:if(e.validatePhone(e.telephone)){t.next=8;break}return e.$toast.fail("请输入正确的手机号码"),t.abrupt("return");case 8:return t.prev=8,e.$toast.loading(),e.forbidSend=!0,e.sendBtnText="(60s)后重新发送",t.next=14,e.$api.login.getPhoneNum({phoneNum:i.default.defaultEncryptRetBase64(e.telephone)});case 14:1==t.sent.code?(e.$toast.success("已发送"),n=60,e.sendBtnText="("+n+"s)后重新发送",e.timer=setInterval((function(){1===n?(e.forbidSend=!1,clearInterval(e.timer)):(--n,e.sendBtnText="("+n+"s)后重新发送")}),1e3)):e.$toast.fail("发送失败"),t.next=21;break;case 18:t.prev=18,t.t0=t.catch(8),setTimeout((function(){e.$toast.clear(),e.forbidSend=!1}),3e3);case 21:case"end":return t.stop()}}),t,e,[[8,18]])})))()}})}},R5mU:function(e,t,n){"use strict";n("iGDb")},iGDb:function(e,t,n){},"qh/1":function(e,t,n){"use strict";n.r(t);var r=n("Efgu"),a=n("9uwL");for(var o in a)["default"].indexOf(o)<0&&function(e){n.d(t,e,(function(){return a[e]}))}(o);n("R5mU");var s=n("gp09"),i=Object(s.a)(a.default,r.a,r.b,!1,null,null,null);t.default=i.exports}}]);