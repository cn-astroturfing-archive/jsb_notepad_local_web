(window.webpackJsonp=window.webpackJsonp||[]).push([[66],{BHfA:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var i=d(a("unDg")),s=d(a("cLjf")),n=d(a("hDQ3")),r=d(a("bS4n")),u=d(a("tI4l")),c=a("dzbt"),l=a("ytsJ"),o=d(a("uhZJ"));function d(t){return t&&t.__esModule?t:{default:t}}e.default={components:{underUnitName:o.default},data:function(){return{detailData:{id:"",subjectName:"",remainSeconds:"",coverImg:"",currentUserTaskNum:"",currentUserUndoTaskNum:"",expireAt:"",expireAtTimemillis:""},loadingListData:!1,isEnd:!1,dataList:[],pageParams:{pageSize:10,pageNo:0},loaded:!1,Dict:u.default,timer:null}},computed:(0,r.default)({},(0,c.mapState)(["userInfo"]),(0,c.mapGetters)(["permissions"])),mounted:function(){var t=this;this.subjectDetail(),this.$nextTick((function(){var e=t.$refs.head,a=t.$refs["task-list-wrap"];a.style.height=a.offsetHeight-e.offsetHeight+"px"})),this.calculateTemainTime()},created:function(){var t,e=this;this.$bus.on("refreshSubjectInfo",(t=(0,n.default)(s.default.mark((function t(a){var i,n,r=a.subjectId;return s.default.wrap((function(t){for(;;)switch(t.prev=t.next){case 0:return t.next=2,e.$api.wechatShareTaskSubjects.subjectDetail({isLoad:!1,id:r});case 2:i=t.sent,n=i.data,e.detailData=n;case 5:case"end":return t.stop()}}),t,e)}))),function(e){return t.apply(this,arguments)}))},destroyed:function(){this.timer&&clearInterval(this.timer),this.$bus.off("refreshSubjectInfo")},methods:{calculateTemainTime:function(){this.timer&&clearTimeout(this.timer),this.detailData.expireAt&&(this.detailData.remainSeconds=(0,l.getTemainTime)(this.detailData.expireAtTimemillis)),this.timer=setTimeout(this.calculateTemainTime,1e3)},subjectDetail:function(){var t=this;return(0,n.default)(s.default.mark((function e(){return s.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:t.detailData=(0,r.default)({},t.$route.query);case 1:case"end":return e.stop()}}),e,t)})))()},onClickLeft:function(){this.$router.go(-1)},onClickRight:function(){this.permissions.includes("subject:view_stats")&&this.$router.push({name:"SpecialColumnStatistics",query:{id:this.detailData.id}})},getListData:function(t){var e=this;return(0,n.default)(s.default.mark((function a(){var n,u,c,l,o;return s.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:if(!e.loadingListData&&!e.isEnd){a.next=3;break}return t(),a.abrupt("return");case 3:return e.loadingListData=!0,e.pageParams.pageNo++,a.next=7,e.$api.task.getIndexList((0,r.default)({isLoad:!1,subjectId:e.$route.query.id},e.pageParams));case 7:u=a.sent,c=u.data,l=c.list,o=c.isLastPage,e.isEnd=o,t(),(n=e.dataList).push.apply(n,(0,i.default)(l)),l.length<1&&e.$refs.my_scroller.finishInfinite(!0),e.loadingListData=!1;case 16:case"end":return a.stop()}}),a,e)})))()},refresh:function(t){var e=this;return(0,n.default)(s.default.mark((function a(){return s.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return e.isEnd=!1,e.pageParams.pageNo=0,e.dataList=[],e.$refs.my_scroller.finishInfinite(!1),a.next=6,e.getListData(t);case 6:case"end":return a.stop()}}),a,e)})))()},infinite:function(t){var e=this;return(0,n.default)(s.default.mark((function a(){return s.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:return a.next=2,e.getListData(t);case 2:case"end":return a.stop()}}),a,e)})))()},toUpload:function(t){this.$router.push({name:"SpecialColumnUpload",query:{id:t.id,isType:t.isType,urlType:t.urlType,title:t.title,subjectId:t.subjectId}})},toUploaded:function(){this.$router.push({name:"SpecialColumnUploaded",query:{id:this.detailData.id,subjectName:this.detailData.subjectName}})},toDetails:function(t){var e=this;return(0,n.default)(s.default.mark((function a(){var i,n,r;return s.default.wrap((function(a){for(;;)switch(a.prev=a.next){case 0:i=[],n=[],(1&t.isType)>0&&(i.push("评论"),n.push("评论"+(t.commentStatus&&t.commentStatus>0?"已完成":"未完成"))),(2&t.isType)>0&&(i.push("点赞"),n.push("点赞"+(t.likeStatus&&t.likeStatus>0?"已完成":"未完成"))),(4&t.isType)>0&&(i.push("分享"),n.push("分享"+(t.shareStatus&&t.shareStatus>0?"已完成":"未完成"))),(8&t.isType)>0&&(i.push("评中评"),n.push("评中评"+(t.cincStatus&&t.cincStatus>0?"已完成":"未完成"))),(16&t.isType)>0&&(i.push("评中赞"),n.push("评中赞"+(t.lincStatus&&t.lincStatus>0?"已完成":"未完成"))),r={url:t.wechatArticleUrl,img:/^https?:\/\//i.test(t.coverImg)?t.coverImg:""+window.location.origin+t.coverImg,title:t.title,desc:t.digest?t.digest.replace(/(<.*?>)|(\n)|(&nbsp;)|(\s)|[↵]/g,"").slice(0,40):"",user_id:e.userInfo.userId,wechat_share_task_id:t.id,show_share:!1,share_url:"",show_tj:!1,tj_url:"",weiboArticleId:t.weiboArticleId?t.weiboArticleId:"",urlType:t.urlType,can_screenshot:[8,12].includes(t.urlType),show_copy_title_jump_app:!((4&t.isType)>0)&&[1,2,8,12].includes(t.urlType),jump_app_scheme:u.default.androidPkgName[t.urlType],website:u.default.urlType[t.urlType],tasktype:i.join("、"),taskprogress:n.join("、"),canComment:(1&t.isType)>0?1:0,taskCategory:t.subjectFlag&&1==t.subjectFlag?2:(8&t.isType)>0||(16&t.isType)>0?3:1,instructionImg:t.instructionImg?/^https?:\/\//.test(t.instructionImg)?t.instructionImg:""+window.location.origin+t.instructionImg:"",toUploadCapture:(4&t.isType)>0?"":window.location.origin+"/jsb-wap/Tasks/SpecialColumnUpload?id="+t.id+"&isType="+t.isType+"&urlType="+t.urlType+"&title="+t.title+"&hideNavigation=1"},e.startDetail(r);case 9:case"end":return a.stop()}}),a,e)})))()}}}},WKpI:function(t,e,a){},XDgK:function(t,e,a){"use strict";a.r(e);var i=a("BHfA"),s=a.n(i);for(var n in i)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(n);e.default=s.a},"YS+N":function(t,e,a){"use strict";a.d(e,"a",(function(){return i})),a.d(e,"b",(function(){return s}));var i=function(){var t=this,e=t._self._c;return e("div",{staticClass:"special-column-details"},[e("van-nav-bar",{attrs:{title:t.$route.meta.title,"left-arrow":"","right-text":t.permissions.includes("subject:view_stats")?"查看统计":"",fixed:""},on:{"click-left":t.onClickLeft,"click-right":t.onClickRight}}),t._v(" "),e("div",{ref:"head",staticClass:"head"},[t.detailData.coverImg?e("van-image",{attrs:{src:t.detailData.coverImg,fit:"cover",width:"1.06667rem",height:"1.06667rem"}}):e("img",{staticClass:"img1",attrs:{src:a("zJNn")}}),t._v(" "),e("div",{staticClass:"texts"},[e("div",{staticClass:"text"},[t._v("\n        "+t._s(t.detailData.subjectName)+"\n      ")]),t._v(" "),e("div",{staticClass:"mes"},[e("p",{staticClass:"nick_name"},[t._v("\n          剩余："),e("span",{class:{"red-color":t.detailData.remainSeconds<14400}},[t._v(t._s(t._f("secondsConvertToDHMS")(t.detailData.remainSeconds)))])]),t._v(" "),e("p",{staticClass:"nick_name"},[t._v("共"+t._s(t.detailData.currentUserTaskNum)+"篇")]),t._v(" "),e("p",{staticClass:"nick_name"},[t._v("\n          待进行"),e("span",{staticClass:"red-color"},[t._v(t._s(t.detailData.currentUserUndoTaskNum))]),t._v("篇\n        ")]),t._v(" "),e("p",{staticClass:"nick_name blue-color",on:{click:function(e){return t.toUploaded()}}},[t._v("已上传图片")])])])],1),t._v(" "),e("div",{ref:"task-list-wrap",staticClass:"task-list-wrap"},[e("scroller",{ref:"my_scroller",attrs:{"on-refresh":t.refresh,"on-infinite":t.infinite}},[e("div",{staticClass:"task-list"},t._l(t.dataList,(function(i){return e("div",{staticClass:"task-item"},[e("div",{staticClass:"platform"},[t.Dict.urlTypeImg[i.urlType]?e("img",{attrs:{src:t.Dict.urlTypeImg[i.urlType],alt:"",srcset:""}}):e("img",{attrs:{src:a("zJNn")}}),t._v(" "),e("div",{staticClass:"name"},[t._v(t._s(t.Dict.urlType[i.urlType]))])]),t._v(" "),e("div",{staticClass:"info"},[e("p",{staticClass:"title",class:{gray:1==i.finishFlag},on:{click:function(e){return t.toDetails(i)}}},[t._v(t._s(i.title))]),t._v(" "),e("div",{staticClass:"handle-box"},[e("van-button",{attrs:{icon:"column",plain:"",type:"default"},on:{click:function(e){return t.toDetails(i)}}},[t._v("打开")]),t._v(" "),e("van-button",{attrs:{icon:"photograph",plain:"",type:"primary",color:"#0a72fe"},on:{click:function(e){return t.toUpload(i)}}},[t._v("上传截图")])],1),t._v(" "),e("div",{staticClass:"upload-msg"},[e("p",t._l(i.importanceLevel,(function(t){return e("img",{key:t,attrs:{src:a("THXo")}})})),0),t._v(" "),i.commentStatus>=0?e("p",{class:{"red-color":0==i.commentStatus}},[t._v("\n                "+t._s(i.commentStatus>0?"评论已上传":"评论待上传")+"\n              ")]):t._e(),t._v(" "),i.likeStatus>=0?e("p",{class:{"red-color":0==i.likeStatus}},[t._v("\n                "+t._s(i.likeStatus>0?"点赞已上传":"点赞待上传")+"\n              ")]):t._e(),t._v(" "),e("underUnitName",{attrs:{detailData:i}})],1)]),t._v(" "),1==i.finishFlag?e("img",{staticClass:"finish_flag",attrs:{src:a("XbOW")}}):t._e()])})),0)])],1)],1)},s=[]},YaNU:function(t,e,a){"use strict";a("WKpI")},ZFi5:function(t,e,a){"use strict";a.r(e);var i=a("YS+N"),s=a("XDgK");for(var n in s)["default"].indexOf(n)<0&&function(t){a.d(e,t,(function(){return s[t]}))}(n);a("YaNU");var r=a("gp09"),u=Object(r.a)(s.default,i.a,i.b,!1,null,"eaad9e78",null);e.default=u.exports}}]);