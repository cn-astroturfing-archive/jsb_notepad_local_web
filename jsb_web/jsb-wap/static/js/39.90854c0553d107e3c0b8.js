(window.webpackJsonp=window.webpackJsonp||[]).push([[39],{"+HRH":function(t,e,a){"use strict";a.r(e);var n=a("pVyE"),i=a("HpBO");for(var s in i)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return i[t]}))}(s);a("VWb3");var o=a("gp09"),r=Object(o.a)(i.default,n.a,n.b,!1,null,"f9397592",null);e.default=r.exports},HpBO:function(t,e,a){"use strict";a.r(e);var n=a("QiXk"),i=a.n(n);for(var s in n)["default"].indexOf(s)<0&&function(t){a.d(e,t,(function(){return n[t]}))}(s);e.default=i.a},QiXk:function(t,e,a){"use strict";Object.defineProperty(e,"__esModule",{value:!0});var n=l(a("vBSJ")),i=l(a("cLjf")),s=l(a("hDQ3")),o=l(a("bS4n"));a("sRnv");var r=l(a("tI4l")),u=(l(a("7Qib")),a("d8ex"),a("fJgZ")),c=l(a("3vVk"));function l(t){return t&&t.__esModule?t:{default:t}}e.default={components:{UploadTip:c.default},data:function(){var t=[{text:"每行图片数1",value:1},{text:"每行图片数2",value:2},{text:"每行图片数3",value:3}];return{detailData:{id:"",urlType:"",isType:"",title:"",subjectId:""},imgDataList:[],Dict:r.default,spans:t,span:t[1],showSpanSelect:!1,types:[],showTypeSelect:!1,currentItem:null,submiting:!1,refreshPrevSubjectInfo:!0,showUploadPop:null,uploadOptions:{},showTip:!1}},computed:{sumbitDebounce:function(){return(0,u.debounce)(this.sumbit,500)},hideNav:function(){return!!this.$route.query.hideNavigation&&1==this.$route.query.hideNavigation}},mounted:function(){this.detailData=(0,o.default)({},this.$route.query),(1&this.detailData.isType)>0&&this.types.push({text:"评论",value:1}),(2&this.detailData.isType)>0&&this.types.push({text:"点赞",value:2}),(8&this.detailData.isType)>0&&this.types.push({text:"评中评",value:8}),(16&this.detailData.isType)>0&&this.types.push({text:"评中赞",value:16}),this.showTip=(1&this.detailData.isType)>0&&(2&this.detailData.isType)>0,this.loadUploadData()},destroyed:function(){this.refreshPrevSubjectInfo&&this.$bus.emit("refreshSubjectInfo",{subjectId:this.detailData.subjectId})},methods:{loadUploadData:function(){var t=this;return(0,s.default)(i.default.mark((function e(){var a,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,t.$api.wechatShareTaskCommon.detail({isLoad:!1,id:t.$route.query.id});case 2:a=e.sent,n=a.data,t.imgDataList=n.map((function(t){return t.operateType=2,t}));case 5:case"end":return e.stop()}}),e,t)})))()},onClickLeft:function(){this.$router.go(-1)},toUpload:function(){this.uploadOptions={type:"photo",interface_type:"img",form_source:1},this.showUploadPop=Math.random()},uploadCallback:function(t){var e=t.code,a=t.data,n=t.message;e&&1==e&&a.filePath?this.imgDataList.push({path:a.filePath,wechatShareId:this.$route.query.id,operateType:1,type:this.types[0].value}):this.$toast.fail(n||"上传失败, 请重新上传")},exchangeImg:function(t){var e=this;this.appUpload({type:"photo",interface_type:"img",form_source:1},(function(a){var n=a.code,i=a.data,s=a.message;n&&1==n&&i.filePath?(t.path=i.filePath,t.reducePath=""):e.$toast.fail(s||"上传失败, 请重新上传")}))},sumbit:function(){var t=this;return(0,s.default)(i.default.mark((function e(){var a,n;return i.default.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(!t.submiting){e.next=3;break}return t.$toast.fail("请勿重复提交"),e.abrupt("return");case 3:return t.submiting=!0,e.prev=4,a=t.imgDataList.filter((function(t){return!(3==t.operateType&&!t.id)})),e.next=8,t.$api.wechatShareTaskCommon.multiSubmit({list:a});case 8:n=e.sent,t.submiting=!1,1==n.code?(t.$toast.success("提交成功"),t.refreshPrevSubjectInfo=!0,t.$router.go(-1)):t.$toast.failure(n.message),e.next=17;break;case 13:e.prev=13,e.t0=e.catch(4),t.submiting=!1,t.$toast.failure("提交失败");case 17:case"end":return e.stop()}}),e,t,[[4,13]])})))()},onSpanConfirm:function(t){this.span=t,this.showSpanSelect=!1},onSpanCancel:function(){this.showSpanSelect=!1},onTypeSelect:function(t){t.id||(this.showTypeSelect=!0,this.currentItem=t)},onTypeConfirm:function(t){this.showTypeSelect=!1,this.currentItem.type=t.value},onTypeCancel:function(){this.showTypeSelect=!1},onImagePreview:function(t){(0,n.default)([t])}}}},RS99:function(t,e,a){},VWb3:function(t,e,a){"use strict";a("RS99")},pVyE:function(t,e,a){"use strict";a.d(e,"a",(function(){return n})),a.d(e,"b",(function(){return i}));var n=function(){var t=this,e=t._self._c;return e("div",{staticClass:"special-column-upload",class:{"hide-nav":t.hideNav}},[t.hideNav?t._e():e("van-nav-bar",{attrs:{title:t.$route.meta.title,"left-arrow":"","right-text":"  ",fixed:""},on:{"click-left":t.onClickLeft}}),t._v(" "),e("p",{staticClass:"article-title"},[t._v("\n      "+t._s(t.Dict.urlType[t.detailData.urlType])+"-----"+t._s(t.detailData.title)+"\n    ")]),t._v(" "),t.showTip?e("div",{staticClass:"tip_div"},[t._v("注意：为避免无法提交，请确保已为点赞和评论任务分别选择了对应的图片类型")]):t._e(),t._v(" "),e("van-row",{staticClass:"list",attrs:{gutter:"20"}},[t._l(t.imgDataList,(function(a,n){return[3!=a.operateType?e("van-col",{staticClass:"item",attrs:{span:24/t.span.value}},[e("div",{staticClass:"img-box"},[e("img",{attrs:{src:a.reducePath?a.reducePath:a.path,alt:"",srcset:""},on:{click:function(e){return t.onImagePreview(a.path)}}}),t._v(" "),a.id||1!=a.operateType?t._e():e("van-icon",{staticClass:"operate-btn delete-btn",attrs:{name:"delete-o"},on:{click:function(t){a.operateType=3}}}),t._v(" "),a.id&&2==a.operateType?e("van-icon",{staticClass:"operate-btn exchange-btn",attrs:{name:"exchange"},on:{click:function(e){return t.exchangeImg(a)}}}):t._e()],1),t._v(" "),e("p",{staticClass:"info-item",on:{click:function(e){return t.onTypeSelect(a)}}},[t._v("\n            类型："+t._s(t.Dict.taskType[a.type])),a.id?t._e():e("van-icon",{staticClass:"van-icon-triangle",attrs:{name:"play"}})],1)]):t._e()]}))],2),t._v(" "),e("div",{staticClass:"bottom-btns"},[e("van-button",{attrs:{type:"info"},on:{click:function(e){return t.toUpload()}}},[t._v(" 上传图片 ")]),t._v(" "),e("van-button",{attrs:{type:"info"},on:{click:function(e){return t.sumbitDebounce()}}},[t._v(" 提交保存 ")])],1),t._v(" "),e("van-popup",{attrs:{position:"bottom"},model:{value:t.showSpanSelect,callback:function(e){t.showSpanSelect=e},expression:"showSpanSelect"}},[e("van-picker",{attrs:{title:"","show-toolbar":"",columns:t.spans},on:{confirm:t.onSpanConfirm,cancel:t.onSpanCancel}})],1),t._v(" "),e("van-popup",{attrs:{position:"bottom"},model:{value:t.showTypeSelect,callback:function(e){t.showTypeSelect=e},expression:"showTypeSelect"}},[e("van-picker",{attrs:{title:"","show-toolbar":"",columns:t.types},on:{confirm:t.onTypeConfirm,cancel:t.onTypeCancel}})],1),t._v(" "),e("UploadTip",{attrs:{uploadOptions:t.uploadOptions,uploadCallback:t.uploadCallback},model:{value:t.showUploadPop,callback:function(e){t.showUploadPop=e},expression:"showUploadPop"}})],1)},i=[]},sRnv:function(t,e,a){"use strict";a.r(e);a("0GPk"),a("00cZ"),a("E8Wu"),a("HVE+"),a("Oe98"),a("lycV"),a("6B5o"),a("fBNp"),a("UZK1"),a("KHSm")}}]);