(window.webpackJsonp=window.webpackJsonp||[]).push([[38],{"2l+p":function(e,t,s){"use strict";s("q8Sq")},"531X":function(e,t){e.exports="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAACAAAAAaCAYAAADWm14/AAAAAXNSR0IArs4c6QAAAARzQklUCAgICHwIZIgAAAKPSURBVEiJxZZPaBNBFMa/N5tNFcRYJB4K9aIUETEe9CQVsSCIrNkOuCcvUipWj4InBWnRm9IePISKRUUplezsQulJCFL/QPEgFDxUEMGDKFItgnQ7yT4PNtBukmaTJvW7vTfz5vuxszNvCE1oZmamIwiCYa31TcdxVppZoyzRaIHneQeXl5fnAFwHkNyMecMASqkhZn5HRIc3a1xWIs4k13V3A3gI4FyrjGMDKKX6ADwG0NVq8w0BcrmcmU6nbwO41sy/EldULamU2kdEk8x8dKNiZs4RUQczB0KIb2EYLpimOWdZ1semAZRSAwBGAeyIu0gVsE9CiDHDMB5YlvUnFsDU1FQqmUyOM/P5Zo2r6AczjxSLxfuO45RqAuTz+eOGYTxj5r0tNF+rWa217TjOYnRAKKVuCSFettEcAHoTicRr3/crTpIgohUA3EZzAAARHQjDsDA9Pd25DsC27TvMfALA53ZDAOjRWk+uAwAAKeVbrfURInq+BRCnfd8fLAcVx9B13UEiGgOwvY0QP7XW+x3HWay44aSU46VS6RiA+XqrMPMQgIvMfImZbzBzDsD7GACdpmleRa2bEAAKhcK2paWlu8x8pdYcIcTObDb7O5p3XXePYRgyDMPLADI1yr9qrbtrApSllLIBTADYFRcgApMlonEA6eiYYRh9dZtMf3+/t9r/X9WbW01SSp+ZDxHRi+hYGIanYnU527a/aK1PAhgBUPVKrQPxPZVKnSGiibV5Zs7U3YKoPM/rZeanALrjbEFUSqknAC6shh8a7vO2bc+appkB8CgIgqDReq31ABG9WQ27Gv4CrZDruj1ENA+A2vbS2UhSygUiugfg138BwL/mNMrMW9F/aiufz5/9CwKX9qciIGItAAAAAElFTkSuQmCC"},AUBh:function(e,t,s){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.default={data:function(){return{seriesId:-1,courseId:-1,courseIndex:0,activeName:"videoTab",lessonInfo:{name:"",description:"",lecturerAvatar:"",lecturerName:"",lecturerDesc:""},videoList:[],progressTimer:null,currentVideoId:null,player:null,isPlaying:!1,fullscreenWatermark:null}},mounted:function(){var e=this;this.$route.query.courseId&&(this.courseId=this.$route.query.courseId),this.$route.query.courseIndex&&(this.courseIndex=this.$route.query.courseIndex),this.$nextTick((function(){e.tryDestroyPlayer(),e.setupFullscreenListener(),e.getCourseVideos(),e.getList()}))},methods:{onClickLeft:function(){this.$router.go(-1)},toggleTab:function(e,t){console.log("toggleTab",e,t)},getList:function(){var e=this;this.$api.onlineCourse.getCourseDetail({isLoad:!1,courseId:this.courseId}).then((function(t){if("200"===t.code){var s=t.data;e.seriesId=s.seriesId,e.lessonInfo.name=s.name,e.lessonInfo.description=s.description,e.lessonInfo.lecturerAvatar=s.lecturerAvatar,e.lessonInfo.lecturerName=s.lecturerName,e.lessonInfo.lecturerDesc=s.lecturerDesc}})).catch((function(e){return console.error(e)}))},toPlayVideo:function(e){this.createPlayerWithVideoData(e),this.isPlaying=!1,this.playVideo()},getStudyProgress:function(e,t,s){this.$api.onlineCourse.updateStudyProgress({isLoad:!1,courseId:this.courseId,seriesId:this.seriesId,videoId:e,status:t,progress:s}).then((function(e){console.log("Study progress updated successfully")})).catch((function(e){return console.error(e)}))},playVideo:function(){this.player?this.isPlaying?(this.player.pause&&this.player.pause(),this.isPlaying=!1):(this.player.play&&this.player.play(),this.isPlaying=!0):console.log("播放器不存在")},getCourseVideos:function(){var e=this;this.$api.onlineCourse.getCourseVideos({isLoad:!1,courseId:this.courseId}).then((function(t){if("200"===t.code){var s=t.data;e.videoList=s;var r=e.getFirstNotComplateVideoData();e.createPlayerWithVideoData(r)}})).catch((function(e){return console.error(e)}))},getFirstNotComplateVideoData:function(){return this.videoList?this.videoList.find((function(e){return!e.videoProgressStat||e.videoProgressStat&&e.videoProgressStat.progressPercentage<100}))||this.videoList[0]:null},createPlayerWithVideoData:function(e){if("function"==typeof window.ctyunplayer)if(e)try{if(this.player||(this.player=ctyunplayer("ctyun-player"),this.setupPlayerEvents()),this.player.setUrl(e.videoUrl),e.videoProgressStat&&e.videoProgressStat.progress){var t=Number(e.videoProgressStat.progress),s=Math.max(0,Math.floor(1e3*t)),r=e.videoProgressStat.status;s>0&&"completed"!==r&&this.player.seekTo&&this.player.seekTo(s)}this.currentVideoId=e.videoId}catch(e){console.error("播放器初始化失败:",e)}else console.error("没有找到视频数据");else console.error("ctyunplayer库未正确加载")},tryDestroyPlayer:function(){try{this.player&&"function"==typeof this.player.dispose&&this.player.dispose()}catch(e){console.warn("Failed to dispose existing player:",e)}finally{this.player=null}},setupPlayerEvents:function(){if(this.player){var e=this;this.player.onPlayMain((function(){console.log("onPlayMain video..."),e.startProgressTracking()})),this.player.onPause((function(){console.log("onPause video..."),setTimeout((function(){if(e.player){var t=e.player.getCurrentPosition?e.player.getCurrentPosition()/1e3:0,s=e.player.getDuration?e.player.getDuration():0;if(s>0&&Math.abs(t-s)<1)return void console.log("视频自然结束，不执行暂停逻辑");console.log("用户主动暂停，执行暂停逻辑"),e.stopProgressTracking(),e.updateStudyProgress()}}),100)})),this.player.onStopMain((function(){console.log("onStopMain video..."),e.stopProgressTracking(),e.updateStudyProgress()}))}},startProgressTracking:function(){this.stopProgressTracking(),this.progressTimer=setInterval(this.updateStudyProgress.bind(this),1e4)},stopProgressTracking:function(){this.progressTimer&&(clearInterval(this.progressTimer),this.progressTimer=null)},updateStudyProgress:function(){if(this.currentVideoId)if(this.player){var e=this.player.getCurrentPosition?this.player.getCurrentPosition()/1e3:0,t=this.player.getDuration?this.player.getDuration():0;console.log("Current time:"+e+"s, Duration:"+t+"s");var s=t>0&&e>0?Math.round(e/t*100):0,r=100==s?"completed":0==s?"not_started":"in_progress";this.getStudyProgress(this.currentVideoId,r,e)}else console.warn("播放器未就绪");else console.warn("当前没有播放的视频")},setupFullscreenListener:function(){var e=this,t=function(){e.isVideoFullscreen()?(console.log("进入全屏..."),e.addFullscreenWatermark()):(console.log("退出全屏..."),e.removeFullscreenWatermark())};document.addEventListener("fullscreenchange",t),document.addEventListener("webkitfullscreenchange",t),document.addEventListener("mozfullscreenchange",t),document.addEventListener("MSFullscreenChange",t),this.$once("hook:beforeDestroy",(function(){document.removeEventListener("fullscreenchange",t),document.removeEventListener("webkitfullscreenchange",t),document.removeEventListener("mozfullscreenchange",t),document.removeEventListener("MSFullscreenChange",t),e.removeFullscreenWatermark()}))},isVideoFullscreen:function(){return!!(document.fullscreenElement||document.webkitFullscreenElement||document.mozFullScreenElement||document.msFullscreenElement)},addFullscreenWatermark:function(){this.removeFullscreenWatermark();var e=document.getElementById("ctyun-player");if(e){var t=this.$store.state.userInfo.username;e.style.position="relative";var s=window.innerWidth,r=window.innerHeight,n=s>r,i=Math.min(s,r)/10,o=Math.round(i*(n?4:3)),a=Math.round(.6*i),l=document.createElement("canvas");l.width=2*o,l.height=o;var c=l.getContext("2d");c.save(),c.translate(l.width/2,l.height/2),c.rotate((n?-45:-30)*Math.PI/180),c.font="bold "+a+"px Vedana, Arial, sans-serif",c.fillStyle="rgba(204, 204, 204, 0.4)",c.textAlign="center",c.textBaseline="middle",c.fillText(""+t,0,0),c.restore();var u=document.createElement("div");u.className="video-watermark-container",u.style.cssText="\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                pointer-events: none;\n                z-index: 999;\n                overflow: hidden;\n            ";var d=document.createElement("div");d.style.cssText="\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-image: url("+l.toDataURL("image/png")+");\n                background-repeat: repeat;\n                background-position: center;\n                opacity: 0.3;\n                z-index: 1;\n            ";var p=document.createElement("div");p.style.cssText="\n                position: absolute;\n                top: 0;\n                left: 0;\n                width: 100%;\n                height: 100%;\n                background-image: url("+l.toDataURL("image/png")+");\n                background-repeat: repeat;\n                background-position: center;\n                opacity: 0.5;\n                z-index: 2;\n            ",u.appendChild(d),u.appendChild(p),e.appendChild(u),this.fullscreenWatermark=u,console.log("全屏水印已添加")}},removeFullscreenWatermark:function(){this.fullscreenWatermark&&(this.fullscreenWatermark.parentNode&&this.fullscreenWatermark.parentNode.removeChild(this.fullscreenWatermark),this.fullscreenWatermark=null),document.querySelectorAll(".video-watermark-container").forEach((function(e){e&&e.parentNode&&e.parentNode.removeChild(e)})),console.log("全屏水印已移除")}},beforeDestroy:function(){this.tryDestroyPlayer(),this.stopProgressTracking()}}},DHXA:function(e,t,s){"use strict";s.d(t,"a",(function(){return r})),s.d(t,"b",(function(){return n}));var r=function(){var e=this,t=e._self._c;return t("div",{staticClass:"lesson-play-wrap"},[t("van-nav-bar",{attrs:{title:e.$route.meta.title,"left-arrow":"",fixed:""},on:{"click-left":e.onClickLeft}}),e._v(" "),e._m(0),e._v(" "),t("div",{staticClass:"cur-lesson"},[t("p",{staticClass:"lesson-title"},[e._v(e._s(e.courseIndex>0?`第${e.courseIndex}课：${e.lessonInfo.name}`:e.lessonInfo.name))]),e._v(" "),t("p",{staticClass:"line"}),e._v(" "),t("van-tabs",{staticClass:"tabs_content",attrs:{"line-height":"4",border:!1},on:{click:e.toggleTab},model:{value:e.activeName,callback:function(t){e.activeName=t},expression:"activeName"}},[t("van-tab",{attrs:{title:"视频列表",name:"videoTab"}},[t("div",{staticClass:"tab-item-warp"},[t("div",{staticClass:"video-ul"},e._l(e.videoList,(function(s,r){return t("div",{key:r,staticClass:"video-item",on:{click:function(t){return e.toPlayVideo(s)}}},[t("p",{staticClass:"video-title"},[e._v(e._s(s.name))]),e._v(" "),t("div",{staticClass:"flex_3"},[t("div",{staticClass:"video-progress"},[t("van-progress",{attrs:{percentage:s.videoProgressStat?s.videoProgressStat.progressPercentage:0,"show-pivot":!1,"stroke-width":"6px",activeColor:"#ff9900",inactiveColor:"#eee"}})],1),e._v(" "),t("span",[e._v(e._s(s.videoProgressStat.progressPercentage?s.videoProgressStat.progressPercentage:0)+"%")])])])})),0)])]),e._v(" "),t("van-tab",{attrs:{title:"课程信息",name:"lessonTab"}},[t("div",{staticClass:"tab-item-warp"},[t("div",{staticClass:"lesson-info"},[t("p",{staticClass:"lesson-into"},[e._v("课程简介")]),e._v(" "),t("p",{staticClass:"into-details"},[e._v(e._s(e.lessonInfo.description))])])])]),e._v(" "),t("van-tab",{attrs:{title:"师资简介",name:"teacherTab"}},[t("div",{staticClass:"tab-item-warp"},[t("div",{staticClass:"auth-info"},[t("div",{staticClass:"avatar"},[t("img",{attrs:{src:e.lessonInfo.lecturerAvatar,alt:""}})]),e._v(" "),t("div",{staticClass:"auth"},[t("p",{staticClass:"name"},[e._v(e._s(e.lessonInfo.lecturerName))]),e._v(" "),t("p",{staticClass:"into"},[e._v(e._s(e.lessonInfo.lecturerDesc))])])])])])],1)],1),e._v(" "),t("div",{staticClass:"bottom-btns"},[t("div",{staticClass:"go-back",on:{click:e.onClickLeft}},[e._m(1),e._v(" "),t("p",[e._v("返回系列")])]),e._v(" "),t("div",{staticClass:"continue",on:{click:e.playVideo}},[e._v(e._s(e.isPlaying?"暂停播放":"开始播放"))])])],1)},n=[function(){var e=this._self._c;return e("div",{staticClass:"video-wrap"},[e("video",{attrs:{id:"ctyun-player",controls:""}})])},function(){var e=this._self._c;return e("div",{staticClass:"back-img"},[e("img",{attrs:{src:s("531X"),alt:""}})])}]},oRAA:function(e,t,s){"use strict";s.r(t);var r=s("DHXA"),n=s("qVN+");for(var i in n)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return n[e]}))}(i);s("2l+p");var o=s("gp09"),a=Object(o.a)(n.default,r.a,r.b,!1,null,"7de9dde9",null);t.default=a.exports},q8Sq:function(e,t,s){},"qVN+":function(e,t,s){"use strict";s.r(t);var r=s("AUBh"),n=s.n(r);for(var i in r)["default"].indexOf(i)<0&&function(e){s.d(t,e,(function(){return r[e]}))}(i);t.default=n.a}}]);